<?xml version="1.0" encoding="utf-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    profile="ncddetectors,saxs,waxs"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean class="gda.device.timer.Etfg" id="Tfg">
        <property name="daServerName" value="DAServer"/>
        <property name="showArmed" value="true"/>
    </bean>

    <bean class="gda.device.memory.Scaler" id="CalibMemory">
        <property name="daServerName" value="DAServer"/>
        <property name="width" value="9"/>
        <property name="height" value="1"/>
        <property name="openCommand" value="tfg open-cc"/>
    </bean>

    <bean class="uk.ac.gda.server.ncd.subdetector.NcdWireDetector" id="Scalers">
        <property name="detectorType" value="CALIB"/>
        <property name="memory" ref="CalibMemory"/>
        <property name="transposedData" value="true"/>
    </bean>

    <bean class="gda.device.memory.GdhistTimes" id="TimesMemory">
        <property name="daServerName" value="DAServer"/>
        <property name="width" value="8"/>
        <property name="height" value="1"/>
        <property name="openCommand" value="module open 'tfg_times' header"/>
    </bean>

    <bean class="uk.ac.gda.server.ncd.subdetector.NcdTimesDetector" id="TfgTimes">
        <property name="detectorType" value="TIMES"/>
        <property name="memory" ref="TimesMemory"/>
    </bean>

    <bean class="uk.ac.gda.server.ncd.plotting.ListenerDispatcher" id="ncdlistener">
        <property name="ncdDetector" ref="ncddetectors"/>
        <property name="energyScannable" ref="energy"/>
    </bean>

    <bean class="uk.ac.gda.server.ncd.scannable.EnergyScannable" id="energy">
        <property name="bragg" ref="dcm_energy"/>
        <property name="protectionLevel" value="2"/>
    </bean>

    <bean class="uk.ac.gda.server.ncd.subdetector.SingleScalerWithScalingAndOffset" id="I0">
        <property name="detectorType" value="CALIB"/>
        <property name="memory" ref="CalibMemory"/>
        <property name="units" value="counts"/>
        <property name="channel" value="1"/>
        <property name="label" value="data"/>
        <property name="scalingAndOffset" ref="d4d2gain"/>
    </bean>

    <bean class="uk.ac.gda.server.ncd.subdetector.SingleScalerWithScalingAndOffset" id="It">
        <property name="detectorType" value="CALIB"/>
        <property name="memory" ref="CalibMemory"/>
        <property name="units" value="counts"/>
        <property name="channel" value="3"/>
        <property name="label" value="data"/>
        <property name="scalingAndOffset" ref="bs2diodegain"/>
    </bean>

    <bean class="uk.ac.gda.server.ncd.subdetector.ConstantScalingAndOffset" id="sao1">
        <property name="offset" value="0"/>
        <property name="scaling" value="1"/>
        <property name="description" value="no scaling or offset"/>
    </bean>

    <bean name="scanStartFastShutterAction" class="uk.ac.gda.server.ncd.actions.TfgIdleStateChange">
        <property name="state" value="0" />
        <property name="channel" value="2" />
        <property name="tfg" ref="Tfg" />
    </bean>

    <bean class="uk.ac.gda.server.ncd.detectorsystem.NcdDetectorSystem" id="ncddetectors">
        <property name="timer" ref="Tfg"/>
        <property name="scanStartActions">
            <list>
                <ref bean="scanStartFastShutterAction"/>
            </list>
        </property>
        <property name="detectors" value="#{getBeanFactory().getBeansOfType(Class.forName('uk.ac.gda.server.ncd.subdetector.INcdSubDetector')).values()}"/>
    </bean>

    <beans profile="saxs" >
        <bean id="saxs_mask" class="uk.ac.gda.server.ncd.meta.NcdMaskLink">
            <property name="detectorType" value="SAXS"/>
            <property name="visitMeta" ref="visit"/>
            <property name="configFileName" value="saxs_masks" />
        </bean>
        <bean id="saxs_cal" class="uk.ac.gda.server.ncd.meta.NcdCalibration">
            <property name="detectorType" value="SAXS"/>
            <property name="visitMeta" ref="visit"/>
            <property name="configFileName" value="saxs_masks" />
        </bean>
    </beans>
    <beans profile="waxs" >
        <bean id="waxs_mask" class="uk.ac.gda.server.ncd.meta.NcdMaskLink">
            <property name="detectorType" value="WAXS"/>
            <property name="visitMeta" ref="visit"/>
            <property name="configFileName" value="saxs_masks" />
        </bean>
        <bean id="waxs_cal" class="uk.ac.gda.server.ncd.meta.NcdCalibration">
            <property name="detectorType" value="WAXS"/>
            <property name="visitMeta" ref="visit"/>
            <property name="configFileName" value="saxs_masks" />
        </bean>
    </beans>
    <beans profile="ionchamber">
        <bean class="uk.ac.gda.server.ncd.subdetector.SingleScalerWithScalingAndOffset" id="IonChamber">
            <property name="detectorType" value="CALIB"/>
            <property name="memory" ref="CalibMemory"/>
            <property name="units" value="counts"/>
            <property name="channel" value="2"/>
            <property name="label" value="data"/>
            <property name="scalingAndOffset" ref="sao1"/>
        </bean>
    </beans>
</beans>
