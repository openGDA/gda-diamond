<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:corba="http://www.diamond.ac.uk/schema/gda/corba"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd
                           http://www.diamond.ac.uk/schema/gda/corba http://www.diamond.ac.uk/schema/gda/corba/gda-corba-1.0.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<bean id="metashop" class="gda.data.metadata.NXMetaDataProvider" />
	
	<bean id="plot_server"
		class="uk.ac.diamond.scisoft.analysis.plotserver.PlotServerBase" />


	<bean id="SimpleServlet" class="gda.util.simpleServlet.FindableSimpleServlet" />
	<bean id="ScanDataStore" class="gda.util.simpleServlet.FindableSimpleServlet" />


	<import resource="commandQueueProcessor.xml" />
	<import resource="CommandServer.xml" />

	<bean id="jythonServerFacade" class="gda.jython.JythonServerFacade">
		<constructor-arg ref="command_server" />
	</bean>

	<!-- Terminal logging so that the terminal output is recorded in a log in 
		the users visit/data directory -->
	<bean id="terminal_logger" class="gda.jython.logger.RedirectableFileLogger">
		<constructor-arg ref="terminallog_path_provider" />
	</bean>
	<bean class="gda.jython.logger.OutputTerminalAdapter">
		<constructor-arg ref="jythonServerFacade" />
		<constructor-arg ref="terminal_logger" />
	</bean>
	<bean class="gda.jython.logger.InputTerminalAdapter">
		<constructor-arg ref="command_server" />
		<constructor-arg ref="terminal_logger" />
	</bean>
	<bean class="gda.jython.logger.ScanDataPointAdapter">
		<constructor-arg ref="jythonServerFacade" />
		<constructor-arg ref="terminal_logger" />
	</bean>
	<bean class="gda.jython.logger.BatonChangedAdapter">
		<constructor-arg ref="jythonServerFacade" />
		<constructor-arg ref="terminal_logger" />
	</bean>
	<bean id="terminallog_path_provider" class="gda.data.ObservablePathConstructor">
		<property name="template"
			value="${gda.data.scan.datawriter.datadir}/gdaterminal.log" />
		<property name="gdaMetadata" ref="GDAMetadata" />
		<property name="local" value="true" />
	</bean>
	<!-- End of terminal logging objects -->
	<bean id="FileRegistrar" class="gda.data.fileregistrar.FileRegistrar">
		<property name="directory"
			value="/dls/bl-misc/dropfiles2/icat/dropZone/${gda.instrument}-" />
		<!-- <property name="directory" -->
		<!-- value="/tmp/${gda.instrument}-" /> -->
	</bean>
	<bean id="DataWriterFactory" class="gda.data.scan.datawriter.DefaultDataWriterFactory">
		<property name="dataWriterExtenders">
			<list>
				<ref bean="FileRegistrar" />
			</list>
		</property>
	</bean>

	<!-- ScriptControllers must be after command_server -->
	<import resource="scriptControllers.xml" />

	<bean class="gda.spring.FindableNameSetterPostProcessor" />
	<bean class="gda.spring.SingletonRegistrationPostProcessor" />
	<!--enable types supported by the PropertyEditors listed in the GdaPropertyEditorRegistrar 
		class -->
	<import resource="classpath:gda/spring/propertyeditors/registration.xml" />

	<!-- corba export must be the final bean. Later beans are not exported via 
		Corba -->
	<corba:export namespace="i12" />

</beans>
