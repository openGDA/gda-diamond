#!/bin/bash
# starts logpanel, servers and namemanager

zenity --title "Are you sure?" --question --text "Are you sure you want to restart the GDA servers?" --window-icon=question
SURE=$?
if [ $SURE == 1 ]; then
  exit
fi

#identify install folder and JAVA_HOME
source /dls_sw/i13-1/etc/i13-1_profile.sh

#echo "Until lustre and system problems are resiolved gda is running on local machine and writing data to /dls_sw/i13-1/software/gda_versions/var/data"
#export JAVA_OPTS="-Xms128m -Xmx1024m -XX:MaxPermSize=128m -XX:+DisableExplicitGC"
#export GDA_DATADIR=/dls_sw/i13-1/software/gda_versions/var/data
#/dls_sw/i13-1/software/gda_versions/gda_trunk2/plugins/uk.ac.gda.core/bin/gda --smart --trace --config=$GDAFOLDER/$BEAMLINE-config --debug -p 8001 --restart -v --mode=live_localhost --nsport 6701 servers
#exit


gdalog &

gda_namemanager &

echo "Keep this window open, and you will see a pop-up when the restart has completed"

#ssh into i13-1-control as gda which should then run the servers script locally there
echo $USER
if [ "$USER" == "tjs15132" ]; 
then ssh -o BatchMode=yes -o StrictHostKeyChecking=no -i $GDAFOLDER/$BEAMLINE-config/${BEAMLINE}ssh_non_permissive.key gda@i13-1-control
else ssh -o BatchMode=yes -o StrictHostKeyChecking=no -i $GDAFOLDER/$BEAMLINE-config/${BEAMLINE}ssh.key gda@i13-1-control
fi
zenity --title "Start the Client?" --question --text "The GDA servers have restarted. Click OK to start the GDA Client." --window-icon=question
STARTCLIENT=$?
if [ $STARTCLIENT == 0 ]; then
  gdaclient
fi
