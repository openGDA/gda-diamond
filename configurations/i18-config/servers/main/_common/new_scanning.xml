<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<description>
		This file contains objects which are required to use the new GDA Solstice / Eclipse Scanning scanning system.
	</description>

	<!-- Data Server -->
	<bean id="dataServer" class="org.eclipse.dawnsci.remotedataset.server.DataServer" init-method="start">
		<property name="port" value="${gda.dataserver.port}" />
	</bean>

	<!-- Device Servlet -->
	<bean id="deviceServlet" class="org.eclipse.scanning.server.servlet.DeviceServlet" init-method="connect">
		<property name="broker" value="${gda.activemq.broker.uri}" />
	</bean>

	<!-- Instead of a standard ScanServlet, I18 uses the HeterogeneousScanServlet which allows experiment commands to
		 be run using the new ActiveMQ queueing system instead of the old command queue -->
	<bean id="scanServlet" class="gda.commandqueue.HeterogeneousScanServlet" init-method="connect">
		<property name="broker" value="${gda.activemq.broker.uri}" />
	</bean>
	
	<bean id="positionerServlet" class="org.eclipse.scanning.server.servlet.PositionerServlet" init-method="connect">
		<property name="broker" value="${gda.activemq.broker.uri}" />
	</bean>
	
	<bean id="acquireServlet" class="org.eclipse.scanning.server.servlet.AcquireServlet" init-method="connect">
		<property name="broker" value="${gda.activemq.broker.uri}" />
	</bean>
	
	<!-- Top-up watchdog -->
	<bean id="topupModel" class="org.eclipse.scanning.api.device.models.DeviceWatchdogModel">
		<property name="countdownName" value="machineTopupMonitor"/>
		<property name="cooloff" value="4000"/>
		<property name="message" value="Paused during topup"/>
		<property name="warmup" value="5000"/>
	</bean>
	
	<bean id="topupWatchdog" class="org.eclipse.scanning.sequencer.watchdog.TopupWatchdog" init-method="activate">
		<property name="model" ref="topupModel"/>
	</bean>
	
	<bean id="expressionModel" class="org.eclipse.scanning.api.device.models.DeviceWatchdogModel">
		<property name="expression" value="ringcurrent >= 1.0 &amp;&amp; !portshutter.equalsIgnoreCase(&quot;Closed&quot;)"/>
		<property name="message" value="Beam has been lost"/>
	</bean>
	
	<bean id="expressionWatchdog" class="org.eclipse.scanning.sequencer.watchdog.ExpressionWatchdog" init-method="activate">
		<property name="model" ref="expressionModel"/>
	</bean>
	
</beans>