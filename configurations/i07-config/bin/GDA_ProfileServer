#!/bin/bash

export BEAMLINE=i07

. /dls_sw/$BEAMLINE/etc/gda_environment.sh

#export PROFILER_DIR=/dls_sw/dasc/jprofiler5
export PROFILER_DIR=/home/xr56/usr/jprofiler5
export LD_LIBRARY_PATH=${PROFILER_DIR}/bin/linux-x64:$LD_LIBRARY_PATH


if [ ! -n "$BEAMLINE" ];
then
  echo "Please set BEAMLINE environment variable."
  exit 1
fi


export gdaLauncher=/dls_sw/$BEAMLINE/software/gda/plugins/uk.ac.gda.core/bin/gda
varDir=/dls_sw/$BEAMLINE/var
dataDir=/dls/$BEAMLINE
logDir=/dls_sw/$BEAMLINE/logs


#echo $gdaLauncher servers
#$gdaLauncher servers

echo Stop all server
$gdaLauncher --stop nameserver
$gdaLauncher --stop logserver
$gdaLauncher --stop eventserver
$gdaLauncher --stop objectserver


echo Restart all servers
echo $gdaLauncher nameserver
$gdaLauncher --vardir=$varDir --logsdir=$logDir nameserver

echo $gdaLauncher --vardir=$varDir --logsdir=$logDir logserver
$gdaLauncher --vardir=$varDir --logsdir=$logDir logserver

echo $gdaLauncher --vardir=$varDir --logsdir=$logDir eventserver
$gdaLauncher --vardir=$varDir --logsdir=$logDir eventserver



echo Restart Object server
#Using the defualt DASC JPorfile
JAVA_OPTS="-Xms512m -Xmx2048m -XX:PermSize=182m -XX:MaxPermSize=786m" $gdaLauncher --debug --profiler --profilerport=8851 --vardir=$varDir --datadir=$dataDir --logsdir=$logDir objectserver


#Using my own JPorfile
#echo JAVA_OPTS="-Xms512m -Xmx2048m -XX:PermSize=182m -XX:MaxPermSize=786m --extra_vmargs_start -agentlib:jprofilerti=port=8851 -Xbootclasspath/a:/home/xr56/usr/jprofiler5/bin/agent.jar extra_vmargs_end" $gdaLauncher --debug --vardir=$varDir --datadir=$dataDir --logsdir=$logDir objectserver
#JAVA_OPTS="-Xms512m -Xmx2048m -XX:PermSize=182m -XX:MaxPermSize=786m --extra_vmargs_start -agentlib:jprofilerti=port=8851 -Xbootclasspath/a:/home/xr56/usr/jprofiler5/bin/agent.jar extra_vmargs_end" $gdaLauncher --debug --vardir=$varDir --datadir=$dataDir --logsdir=$logDir objectserver



