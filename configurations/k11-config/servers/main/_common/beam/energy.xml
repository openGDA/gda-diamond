<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!-- RESOURCES -->
	<!-- Scripts -->
	<bean id="shutter_functions" class="java.io.File">
		<constructor-arg value="${gda.function.columnDataFile.lookupDir}/shutter_functions.py" />
	</bean>
	
	<bean id="m1m2_functions" class="java.io.File">
		<constructor-arg value="${gda.function.columnDataFile.lookupDir}/m1m2_functions.py" />
	</bean>

	<bean id="dcm1_functions" class="java.io.File">
		<constructor-arg value="${gda.function.columnDataFile.lookupDir}/dcm1_functions.py" />
	</bean>
	
	<bean id="aux_functions" class="java.io.File">
		<constructor-arg value="${gda.function.columnDataFile.lookupDir}/aux_functions.py" />
	</bean>

	<!-- Lookup tables -->
	<bean id="m1m2_lut" class="uk.ac.diamond.daq.beamline.configuration.RangeLookupService">
		<constructor-arg name="csvFile">
			<bean class="java.io.File">
				<constructor-arg value="${gda.function.columnDataFile.lookupDir}/m1m2lookup.csv" />
			</bean>
		</constructor-arg>
		<constructor-arg name="lowColumn" value="Low" />
		<constructor-arg name="highColumn" value="High" />
	</bean>

	<bean id="s1_lut" class="uk.ac.diamond.daq.beamline.configuration.RangeLookupService">
		<constructor-arg name="csvFile">
			<bean class="java.io.File">
				<constructor-arg value="${gda.function.columnDataFile.lookupDir}/s1_MonoDiff_lookup.csv" />
			</bean>
		</constructor-arg>
		<constructor-arg name="lowColumn" value="Low" />
		<constructor-arg name="highColumn" value="High" />
	</bean>
	
	<!-- Common to all beams -->
	<bean id="s1_operational_lut" class="uk.ac.diamond.daq.beamline.configuration.RangeLookupService">
		<constructor-arg name="csvFile">
			<bean class="java.io.File">
				<constructor-arg value="${gda.function.columnDataFile.lookupDir}/s1_OperationalPos_lookup.csv" />
			</bean>
		</constructor-arg>
		<constructor-arg name="lowColumn" value="Low" />
		<constructor-arg name="highColumn" value="High" />
	</bean>

	<bean id="s2_lut" class="uk.ac.diamond.daq.beamline.configuration.RangeLookupService">
		<constructor-arg name="csvFile">
			<bean class="java.io.File">
				<constructor-arg value="${gda.function.columnDataFile.lookupDir}/s2lookup.csv" />
			</bean>
		</constructor-arg>
		<constructor-arg name="lowColumn" value="Low" />
		<constructor-arg name="highColumn" value="High" />
	</bean>
	
	
	<!-- WORKFLOW ITEMS -->

	<!-- Shutters -->
	<bean id="close_shutters" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="shutter_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="fe_shutter" value="fe_shutter_close" />
				<entry key-ref="dummy_eh_shutter" value="eh_shutter_close" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>
	
	<bean id="open_shutters" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="shutter_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="fe_shutter" value="fe_shutter_open" />
				<entry key-ref="dummy_eh_shutter" value="eh_shutter_open" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>
	
	<!-- Mirrors -->
	
	<bean id="move_m1m2_x_pitch_roll_yaw" class="uk.ac.diamond.daq.beamline.configuration.LookupTableBasedItem">
	 	<constructor-arg name="inputProperty" value="energy" />
	 	<constructor-arg name="scannables">
			<map>
				<entry key="M1 X" value-ref="m1_x" />
				<entry key="M1 Roll" value-ref="m1_roll" />
				<entry key="M1 Pitch" value-ref="m1_pitch" />
				<entry key="M1 Yaw" value-ref="m1_yaw" />
				<entry key="M2 X" value-ref="m2_x" />
				<entry key="M2 Roll" value-ref="m2_roll" />
				<entry key="M2 Pitch" value-ref="m2_pitch" />
				<entry key="M2 Yaw" value-ref="m2_yaw" />
			</map>
		</constructor-arg>
		<constructor-arg name="positionLookupService" ref="m1m2_lut" />
	</bean>

	<bean id="move_m1m2_y" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="m1m2_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="m1_y" value="m1_y_in" />
				<entry key-ref="m2_y" value="m2_y_in" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>
	
	<!--
	HACK ALERT!
	Some scannables are heavily coupled outside of GDA, and currently our best solution
	for their inclusion in a configuration workflow is for them to be moved inside the script logic.
	GDA still expects to move a single scannable after evaluating a script function,
	so here we provide a dummy scannable to keep the signature happy and treat the item as a black box
	-->
	<bean id="black_box_scannable" class="gda.device.scannable.DummyScannableMotor" />
	
	<bean id="move_m1m2_benders" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="m1m2_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="black_box_scannable" value="m2_bender_current_position_check" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>
	
	<!-- DCM -->
	
	<bean id="move_dcm1_bragg_y_z" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="dcm1_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="dcm1_y" value="dcm1_y_in" />
				<entry key-ref="dcm1_bragg" value="dcm1_bragg_position" />
				<entry key-ref="dcm1_z" value="dcm1_z_position" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>
	
	<bean id="move_dcm1_roll" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="dcm1_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="dcm1_roll" value="dcm1_roll_position" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>

	<bean id="move_dcm1_pitch" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="dcm1_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="dcm1_pitch" value="dcm1_pitch_position" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>
	
	<!-- Slits -->
	
	<bean id="move_s1" class="uk.ac.diamond.daq.beamline.configuration.LookupTableBasedItem">
	 	<constructor-arg name="inputProperty" value="energy" />
	 	<constructor-arg name="scannables">
			<map>
				<entry key="S1 X Plus" value-ref="s1_xplus" />
				<entry key="S1 X Minus" value-ref="s1_xminus" />
				<entry key="S1 Y Plus" value-ref="s1_yplus" />
				<entry key="S1 Y Minus" value-ref="s1_yminus" />
			</map>
		</constructor-arg>
		<constructor-arg name="positionLookupService" ref="s1_lut" />
	</bean>
	
	<bean id="move_s2" class="uk.ac.diamond.daq.beamline.configuration.LookupTableBasedItem">
	 	<constructor-arg name="inputProperty" value="energy" />
	 	<constructor-arg name="scannables">
			<map>
				<entry key="S2 X Plus" value-ref="s2_xplus" />
				<entry key="S2 X Minus" value-ref="s2_xminus" />
				<entry key="S2 Y Plus" value-ref="s2_yplus" />
				<entry key="S2 Y Minus" value-ref="s2_yminus" />
			</map>
		</constructor-arg>
		<constructor-arg name="positionLookupService" ref="s2_lut" />
	</bean>

	<!-- Beam selector -->

	<bean id="move_beam_selector_diff" class="uk.ac.diamond.daq.beamline.configuration.ScriptBasedItem">
		<constructor-arg name="script" ref="aux_functions" />
		<constructor-arg name="functionsPerScannable">
			<map>
				<entry key-ref="beam_selector" value="beam_selector_monoDiff_pos" />
			</map>
		</constructor-arg>
		<constructor-arg name="inputProperty" value="energy" />
	</bean>
	
	<bean id="move_s1_operational" class="uk.ac.diamond.daq.beamline.configuration.LookupTableBasedItem">
	 	<constructor-arg name="inputProperty" value="energy" />
	 	<constructor-arg name="scannables">
			<map>
				<entry key="S1 X Plus" value-ref="s1_xplus" />
				<entry key="S1 X Minus" value-ref="s1_xminus" />
				<entry key="S1 Y Plus" value-ref="s1_yplus" />
				<entry key="S1 Y Minus" value-ref="s1_yminus" />
			</map>
		</constructor-arg>
		<constructor-arg name="positionLookupService" ref="s1_operational_lut" />
	</bean>
	
	<!-- WORKFLOWS -->	
	
	<bean id="diffraction_mono_workflow" class="uk.ac.diamond.daq.beamline.configuration.DefaultConfigurationWorkflow">
		<constructor-arg name="workflowItems">
			<map>
				<entry key-ref="close_shutters">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Closing front end and experimental hutch shutters"/>
						<constructor-arg name="percentage" value="3" />
					</bean>
				</entry>
				
				<entry key-ref="move_s1">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Adjusting S1 slits"/>
						<constructor-arg name="percentage" value="7" />
					</bean>
				</entry>
				
				<entry key-ref="move_m1m2_x_pitch_roll_yaw">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="moving M1 and M2 mirrors (x, pitch, roll, yaw)"/>
						<constructor-arg name="percentage" value="15" />
					</bean>
				</entry>

				<entry key-ref="move_m1m2_y">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="moving M1 and M2 mirrors (y)"/>
						<constructor-arg name="percentage" value="25" />
					</bean>
				</entry>

				<entry key-ref="move_dcm1_bragg_y_z">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="moving DCM1 (bragg, y, z)"/>
						<constructor-arg name="percentage" value="40" />
					</bean>
				</entry>

				<entry key-ref="move_s2">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Adjusting S2 slits"/>
						<constructor-arg name="percentage" value="50" />
					</bean>
				</entry>

				<entry key-ref="move_m1m2_benders">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="moving M1 and M2 mirrors (benders)"/>
						<constructor-arg name="percentage" value="70" />
					</bean>
				</entry>
					
				<entry key-ref="move_dcm1_roll">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Moving DCM 1 (roll)"/>
						<constructor-arg name="percentage" value="80" />
					</bean>
				</entry>
					
				<entry key-ref="move_beam_selector_diff">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Moving beam selector"/>
						<constructor-arg name="percentage" value="87" />
					</bean>
				</entry>
					
				<entry key-ref="move_dcm1_pitch">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Moving DCM1 pitch"/>
						<constructor-arg name="percentage" value="95" />
					</bean>
				</entry>
				
				<entry key-ref="move_s1_operational">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Moving S1"/>
						<constructor-arg name="percentage" value="100" />
					</bean>
				</entry>
				
				<entry key-ref="open_shutters">
					<bean class="uk.ac.diamond.daq.beamline.configuration.ProgressInformation">
						<constructor-arg name="description" value="Opening front end and experimental hutch shutters"/>
						<constructor-arg name="percentage" value="90" />
					</bean>
				</entry>
			</map>
		</constructor-arg>
	</bean>
	
	
	<!-- The following don't do anything (yet!) -->
	<bean id="imaging_pink_workflow" class="uk.ac.diamond.daq.beamline.configuration.DefaultConfigurationWorkflow">
		<constructor-arg name="workflowItems">
			<map />
		</constructor-arg>
	</bean>
	
	<bean id="imaging_mono_workflow" class="uk.ac.diamond.daq.beamline.configuration.DefaultConfigurationWorkflow">
		<constructor-arg name="workflowItems">
			<map />
		</constructor-arg>
	</bean>
	
</beans>
