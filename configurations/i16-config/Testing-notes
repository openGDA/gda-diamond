================================================================================
2020-01-28 (live) Testing hdf5 file writing

---------------------------------------------------------------- Before all test:

>>> datadir
u'/dls/i16/data/2020/mm24498-1'

>>> newexperiment('cm26473-1')
new record log:  /dls/i16/data/2020/cm26473-1/gdaterminal.log
/dls_sw/i16/scripts/2020/cm26473-1 already exists
/dls_sw/i16/scripts/2020/cm26473-1/cm26473-1.txt already exists
/dls_sw/i16/scripts/2020/cm26473-1/cm26473-1.py already exists
Logbook already exists: /dls_sw/i16/software/python/userscripts/i16user/logbooks/2020/cm26473-1.ipynb
To view the logbook, start Jupyter from desktop link

------------------------------------------------------------------- Before test:

>>> kphiZebraPos=kphiZebra() ; print "kphiZebraPos=%r" % (kphiZebraPos)
kphiZebraPos=57.045

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 5.000000 path: 112552 maxx: 0 maxy: 0 maxval: 0.000000 sum: -22

----------------------------- Baseline tests with pil3_100k using tiffs only:

				Try a 3 point scan

>>> scan   kphi      kphiZebraPos-1 kphiZebraPos+1 1   pil3_100k 0.1
=== Scan started: Tue Jan 28 15:09:37 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
Image location: pilatus3_100k_path_template='809133-pilatus3_100k-files/%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809133.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/809133.dat
  kphi	       kap	     kth	   kmu	kdelta	  kgam	delta_axis_offset	   TimeSec	 TimeFromEpoch	ic1monitor	    rc	count_time	path	maxx	maxy	  maxval	sum
56.045	-134.75593	57.04516	0.0000	0.0000	0.0000	                0	545989.211	1580224179.520	  0.460978	0.0478	  0.100000	   1	   0	   0	0.000000	-22
57.045	-134.75593	57.04516	0.0000	0.0000	0.0000	                0	545990.585	1580224180.895	  0.457927	0.0513	  0.100000	   2	   0	   0	0.000000	-22
58.045	-134.75593	57.04516	0.0000	0.0000	0.0000	                0	545991.960	1580224182.269	  0.503718	0.0492	  0.100000	   3	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 15:09:42 2020. Elapsed time: 5 seconds
   maxval: At kphi = 56.045 (maxpos), pil3_100k.sum maxval = -22.0. 
   minval: At kphi = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphi = 57.045 (com), pil3_100k.sum stddev = 0.666666666667. 
   peak:   Exception: ValueError('There is no peak',)
   lcen:   At kphi = 54.045 (lcen), pil3_100k.sum . 
   rcen:   At kphi = 60.045 (rcen), pil3_100k.sum .

				Try a 201 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .01 pil3_100k 0.1
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 28 15:11:41 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
WARNING: kphi is returning a position based on its real motor position (56.032) rather than its last demanded position(58.045),
as these differ by more than the configured demand position tolerance (0.001).
Metadata collection complete
Image location: pilatus3_100k_path_template='809135-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809135.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/809135.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   56.045	  0.100000	   0	   0	   0	0.000000	-22
...
   58.045	  0.100000	 200	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 15:12:04 2020. Elapsed time: 23 seconds
   maxval: At kphiZebra = 56.196 (maxpos), pil3_100k.sum maxval = -2.0. 
   minval: At kphiZebra = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 57.0474666208 (com), pil3_100k.sum stddev = 0.335801547349. 
   peak:   At kphiZebra = 56.1961546719 (pos), pil3_100k.sum offset = -21.7849901328, fwhm = 0.00302148550738, residual = 189.755000522, top = 21.2132827298. 
   lcen:   At kphiZebra = 55.035 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 59.055 (rcen), pil3_100k.sum .

				Try a 2001 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01
...

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01
Waiting for file /dls/i16/data/2020/cm26473-1/809135-kphiZebraPil3-files/00000_00201.tif, 5/60s

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.010000 path: 112555 maxx: 0 maxy: 0 maxval: 0.000000 sum: -22

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 28 15:16:41 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='809137-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809137.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/809137.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   56.045	  0.010000	   0	   0	   0	0.000000	-22
...
   58.046	  0.010000	2000	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 15:17:26 2020. Elapsed time: 45 seconds
   maxval: At kphiZebra = 56.922 (maxpos), pil3_100k.sum maxval = 17.0. 
   minval: At kphiZebra = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 57.0464102582 (com), pil3_100k.sum stddev = 0.333755107766. 
   peak:   At kphiZebra = 56.9220867962 (pos), pil3_100k.sum offset = -21.9715630247, fwhm = 0.00046606290481, residual = 417.375690527, top = 45.658185476. 
   lcen:   At kphiZebra = 55.0435 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 59.0475 (rcen), pil3_100k.sum .

				Try a 5001 point cvscan (0.001 exposure time, 0.004 Acq Period)

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0004 pil3_100k 0.004
...

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.004000 path: 112556 maxx: 131 maxy: 82 maxval: 2.000000 sum: -19

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0004 pil3_100k 0.004
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 28 15:20:28 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='809139-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809139.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/809139.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   56.045	  0.004000	   0	   0	   0	0.000000	-22
...
   58.045	  0.004000	5000	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 15:22:04 2020. Elapsed time: 96 seconds
   maxval: At kphiZebra = 57.675 (maxpos), pil3_100k.sum maxval = -19.0. 
   minval: At kphiZebra = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 57.0447481503 (com), pil3_100k.sum stddev = 0.333480405586. 
   peak:   At kphiZebra = 57.6748626846 (pos), pil3_100k.sum offset = -21.9997924068, fwhm = 0.000469992234475, residual = 5.49980055168, top = 2.02245567361. 
   lcen:   At kphiZebra = 55.045 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 59.045 (rcen), pil3_100k.sum . 

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.004000 path: 112557 maxx: 166 maxy: 97 maxval: 2.000000 sum: -14

>>> pos kphiZebra kphiZebraPos
Move completed: kphiZebra : 57.045

------------------------------- Tests with pil3_100k using tiffs and hdf5s:

>>> kphiZebraPos=kphiZebra() ; print "kphiZebraPos=%r" % (kphiZebraPos)
kphiZebraPos=57.045

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.000000 path: 112563 maxx: 411 maxy: 60 maxval: 2.000000 sum: -16

				Try a 3 point scan

>>> scan   kphi      kphiZebraPos-1 kphiZebraPos+1 1   pil3_100k 0.1
=== Scan started: Tue Jan 28 18:41:09 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
Image location: pilatus3_100k_path_template='809150-pilatus3_100k-files/%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809150.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/809150.dat
  kphi	       kap	     kth	       kmu	    kdelta	      kgam	delta_axis_offset	TimeSec	 TimeFromEpoch	ic1monitor	    rc	count_time	path	maxx	maxy	  maxval	sum
56.045	-134.75603	57.04516	2.0585e-06	6.8008e-05	0.00096932	                0	190.999	1580236872.894	  0.497615	0.0204	  0.100000	   1	   0	   0	0.000000	-22
57.045	-134.75603	57.04516	2.0585e-06	6.8008e-05	0.00096932	                0	192.543	1580236874.438	  0.534246	0.0196	  0.100000	   2	   0	   0	0.000000	-22
58.045	-134.75602	57.04516	2.0585e-06	6.8008e-05	0.00096932	                0	194.088	1580236875.983	  0.494558	0.0219	  0.100000	   3	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 18:41:16 2020. Elapsed time: 7 seconds
   maxval: At kphi = 56.045 (maxpos), pil3_100k.sum maxval = -22.0. 
   minval: At kphi = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphi = 57.045 (com), pil3_100k.sum stddev = 0.666666666667. 
   peak:   Exception: ValueError('There is no peak',)
   lcen:   At kphi = 54.045 (lcen), pil3_100k.sum . 
   rcen:   At kphi = 60.045 (rcen), pil3_100k.sum .

				Try a 201 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .01 pil3_100k 0.1
kphi removed from list of default Scannables. Add back to the list by using command: add_default kphi
kap removed from list of default Scannables. Add back to the list by using command: add_default kap
kth removed from list of default Scannables. Add back to the list by using command: add_default kth
kmu removed from list of default Scannables. Add back to the list by using command: add_default kmu
kdelta removed from list of default Scannables. Add back to the list by using command: add_default kdelta
kgam removed from list of default Scannables. Add back to the list by using command: add_default kgam
delta_axis_offset removed from list of default Scannables. Add back to the list by using command: add_default delta_axis_offset
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
atime removed from list of default Scannables. Add back to the list by using command: add_default atime
atimetwo removed from list of default Scannables. Add back to the list by using command: add_default atimetwo
ic1monitor removed from list of default Scannables. Add back to the list by using command: add_default ic1monitor
rc removed from list of default Scannables. Add back to the list by using command: add_default rc
WaitForInjection removed from list of default Scannables. Add back to the list by using command: add_default WaitForInjection
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 28 18:46:17 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='809151-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809151.nxs
WARNING: kphi is returning a position based on its real motor position (56.11) rather than its last demanded position(58.045),
as these differ by more than the configured demand position tolerance (0.001).
Writing data to file: /dls/i16/data/2020/cm26473-1/809151.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   56.045	  0.100000	   0	   0	   0	0.000000	-22
...
   58.045	  0.100000	 200	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 18:46:42 2020. Elapsed time: 25 seconds
   maxval: At kphiZebra = 57.905 (maxpos), pil3_100k.sum maxval = 0.0. 
   minval: At kphiZebra = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 57.0326361949 (com), pil3_100k.sum stddev = 0.334587303841. 
   peak:   At kphiZebra = 57.7567263937 (pos), pil3_100k.sum offset = -21.9031196801, fwhm = 0.891852498973, residual = 1224.54199998, top = 1.3290071368. 
   lcen:   At kphiZebra = 55.036 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 59.054 (rcen), pil3_100k.sum . 

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.100000 path: 112564 maxx: 0 maxy: 0 maxval: 0.000000 sum: -22

				Try a 2001 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 28 18:48:02 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='809152-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809152.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/809152.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   56.045	  0.010000	   0	   0	   0	0.000000	-22
...
   58.046	  0.010000	2000	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 18:48:42 2020. Elapsed time: 40 seconds
   maxval: At kphiZebra = 57.034 (maxpos), pil3_100k.sum maxval = -11.0. 
   minval: At kphiZebra = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 57.0460197545 (com), pil3_100k.sum stddev = 0.333825864829. 
   peak:   At kphiZebra = 57.0337868017 (pos), pil3_100k.sum offset = -21.989475646, fwhm = 0.000293117304293, residual = 72.7795016976, top = 50.7110894021. 
   lcen:   At kphiZebra = 55.0435 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 59.0475 (rcen), pil3_100k.sum . 

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.010000 path: 112565 maxx: 193 maxy: 68 maxval: 2.000000 sum: -4

				Try a 5001 point cvscan (0.001 exposure time, 0.004 Acq Period)

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0004 pil3_100k 0.004
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 28 18:49:36 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='809153-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/809153.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/809153.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   56.045	  0.004000	   0	   0	   0	0.000000	-22
...
   58.045	  0.004000	5000	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 28 18:51:08 2020. Elapsed time: 92 seconds
   maxval: At kphiZebra = 56.638 (maxpos), pil3_100k.sum maxval = -11.0. 
   minval: At kphiZebra = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 57.0448460818 (com), pil3_100k.sum stddev = 0.33353413881. 
   peak:   At kphiZebra = 56.6380777726 (pos), pil3_100k.sum offset = -21.995114218, fwhm = 0.000572092661537, residual = 218.385053636, top = 6.16533440565. 
   lcen:   At kphiZebra = 55.045 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 59.045 (rcen), pil3_100k.sum . 

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.004000 path: 112566 maxx: 0 maxy: 0 maxval: 0.000000 sum: -22

------------------------------------------------------------------- After test:

>>> pos kphiZebra kphiZebraPos
Move completed: kphiZebra : 57.045

>>> newexperiment('mm24498-1')
new record log:  /dls/i16/data/2020/mm24498-1/gdaterminal.log
/dls_sw/i16/scripts/2020/mm24498-1 already exists
/dls_sw/i16/scripts/2020/mm24498-1/mm24498-1.txt already exists
/dls_sw/i16/scripts/2020/mm24498-1/mm24498-1.py already exists
Logbook already exists: /dls_sw/i16/software/python/userscripts/i16user/logbooks/2020/mm24498-1.ipynb
To view the logbook, start Jupyter from desktop link

================================================================================
2020-01-21 (live) Testing hdf5 file writing

------------------------------------------------------------------- Before test:

>>> kphiZebraPos=kphiZebra() ; print "kphiZebraPos=%r" % (kphiZebraPos)
kphiZebraPos=170.008

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.100000 path: 111839 maxx: 146 maxy: 10 maxval: 2.000000 sum: -7

----------------------------- Baseline tests with pil3_100k using tiffs only:

				Try a 3 point scan

>>> scan   kphi      kphiZebraPos-1 kphiZebraPos+1 1   pil3_100k 0.1
=== Scan started: Tue Jan 21 17:35:25 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
Image location: pilatus3_100k_path_template='808384-pilatus3_100k-files/%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808384.nxs
Writing data to file: /dls/i16/data/2020/mm23911-1/808384.dat
  kphi	       kap	     kth	   kmu	kdelta	  kgam	delta_axis_offset	   TimeSec	 TimeFromEpoch	ic1monitor	     rc	count_time	path	maxx	maxy	  maxval	sum
169.01	-134.75593	59.24968	0.0000	31.376	33.173	           8.8000	601497.107	1579628127.788	  0.457927	99.9747	  0.100000	   1	   0	   0	0.000000	-22
170.01	-134.75593	59.24968	0.0000	31.376	33.173	           8.8000	601498.480	1579628129.160	  0.512877	99.9732	  0.100000	   2	   0	   0	0.000000	-22
171.01	-134.75593	59.24968	0.0000	31.376	33.173	           8.8000	601499.831	1579628130.512	  0.518984	99.9706	  0.100000	   3	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 21 17:35:30 2020. Elapsed time: 5 seconds
   maxval: At kphi = 169.008 (maxpos), pil3_100k.sum maxval = -22.0. 
   minval: At kphi = 169.008 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphi = 170.008 (com), pil3_100k.sum stddev = 0.666666666667. 
   peak:   Exception: ValueError('There is no peak',)
   lcen:   At kphi = 167.008 (lcen), pil3_100k.sum . 
   rcen:   At kphi = 173.008 (rcen), pil3_100k.sum .

				Try a 201 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .01 pil3_100k 0.1
...
=== Scan started: Tue Jan 21 17:38:46 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='808385-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808385.nxs
WARNING: kphi is returning a position based on its real motor position (169.098) rather than its last demanded position(171.008),
as these differ by more than the configured demand position tolerance (0.001).
Writing data to file: /dls/i16/data/2020/mm23911-1/808385.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   169.01	  0.100000	   0	   0	   0	0.000000	-22
...
   171.01	  0.100000	 200	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 21 17:39:11 2020. Elapsed time: 26 seconds
   maxval: At kphiZebra = 169.95 (maxpos), pil3_100k.sum maxval = 65.0. 
   minval: At kphiZebra = 169.008 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 170.012208442 (com), pil3_100k.sum stddev = 0.349205991885. 
   peak:   At kphiZebra = 169.947664857 (pos), pil3_100k.sum offset = -21.4093293807, fwhm = 0.00680975237408, residual = 2462.48905213, top = 127.656678967. 
   lcen:   At kphiZebra = 167.9975 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 172.0195 (rcen), pil3_100k.sum .

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01 # 201 points
>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01
Waiting for file /dls/i16/data/2020/mm23911-1/808385-kphiZebraPil3-files/00000_00201.tif, 5/60s

				Had to stop multiple times to get it to stop

>>> pos pil3_100k 1
Traceback (most recent call last):
  File "<input>", line 1, in <module>

gda.device.DeviceException: gov.aps.jca.TimeoutException: Put on BL16I-EA-PILAT-03:CAM:FileWriteMode timeout 5.000000s

				Couldn't fix with this, so restarted the IOC

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.010000 path: 111840 maxx: 247 maxy: 78 maxval: 2.000000 sum: -19

				Try a 2001 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01
...
=== Scan started: Tue Jan 21 17:59:47 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='808387-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808387.nxs
Writing data to file: /dls/i16/data/2020/mm23911-1/808387.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   169.01	  0.010000	   0	   0	   0	0.000000	-22
...
   171.01	  0.010000	2000	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 21 18:00:40 2020. Elapsed time: 53 seconds
   maxval: At kphiZebra = 170.289 (maxpos), pil3_100k.sum maxval = -11.0. 
   minval: At kphiZebra = 169.008 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 170.009277562 (com), pil3_100k.sum stddev = 0.333843634212. 
   peak:   At kphiZebra = 169.249615922 (pos), pil3_100k.sum offset = -21.9846168901, fwhm = 0.000543952060029, residual = 286.519290709, top = 16.898010426. 
   lcen:   At kphiZebra = 168.0065 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 172.0105 (rcen), pil3_100k.sum .

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.010000 path: 111841 maxx: 0 maxy: 0 maxval: 0.000000 sum: -22

				Try a 20001 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0001 pil3_100k 0.001
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 21 18:02:59 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='808388-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808388.nxs
Writing data to file: /dls/i16/data/2020/mm23911-1/808388.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   169.01	  0.001000	   0	 331	  65	2.000000	 -5
...
				Tried to set a -0.002 exposure time with a 0.001 Acq Period!
				Ended up only seeing 20 triggers

>>> pos pil3_100k 1
Traceback (most recent call last):
  File "<input>", line 1, in <module>

gda.device.DeviceException: gov.aps.jca.TimeoutException: Put on BL16I-EA-PILAT-03:CAM:FileWriteMode timeout 5.000000s

				Restart IOC again

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.001000 path: 111842 maxx: 414 maxy: 62 maxval: 2.000000 sum: -17

				Try a 4001 point cvscan (0.002 exposure time, 0.005 Acq Period)

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0005 pil3_100k 0.005
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 21 18:11:46 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='808389-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808389.nxs
Writing data to file: /dls/i16/data/2020/mm23911-1/808389.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   169.01	  0.005000	   0	   0	   0	0.000000	-22
...
   171.01	  0.005000	4000	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 21 18:13:16 2020. Elapsed time: 91 seconds
   maxval: At kphiZebra = 170.641 (maxpos), pil3_100k.sum maxval = -11.0. 
   minval: At kphiZebra = 169.008 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 170.008160676 (com), pil3_100k.sum stddev = 0.333587037003. 
   peak:   At kphiZebra = 170.641093227 (pos), pil3_100k.sum offset = -21.9887780727, fwhm = 0.000362387823078, residual = 393.243400769, top = 3.49928759118. 
   lcen:   At kphiZebra = 168.008 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 172.008 (rcen), pil3_100k.sum .

				Try a 5001 point cvscan (0.001 exposure time, 0.004 Acq Period)

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0004 pil3_100k 0.004
Waiting for file /dls/i16/data/2020/mm23911-1/808389-kphiZebraPil3-files/00000_04001.tif, 5/60s

				Had to stop multiple times

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.004000 path: 111843 maxx: 0 maxy: 0 maxval: 0.000000 sum: -22

				Try a 5001 point cvscan (0.001 exposure time, 0.004 Acq Period)

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0004 pil3_100k 0.004
meta added to the list of default Scannables. Remove from the list by using command: remove_default meta
meta removed from list of default Scannables. Add back to the list by using command: add_default meta
=== Scan started: Tue Jan 21 18:17:16 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='808391-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808391.nxs
Writing data to file: /dls/i16/data/2020/mm23911-1/808391.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   169.01	  0.004000	   0	   0	   0	0.000000	-22
...
   171.01	  0.004000	5000	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 21 18:19:08 2020. Elapsed time: 112 seconds
   maxval: At kphiZebra = 169.126 (maxpos), pil3_100k.sum maxval = -15.0. 
   minval: At kphiZebra = 169.008 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphiZebra = 170.008425669 (com), pil3_100k.sum stddev = 0.333486131247. 
   peak:   At kphiZebra = 169.690881439 (pos), pil3_100k.sum offset = -21.9985975387, fwhm = 0.000432624408845, residual = 48.9902041958, top = 9.17671483462. 
   lcen:   At kphiZebra = 168.0075 (lcen), pil3_100k.sum . 
   rcen:   At kphiZebra = 172.0095 (rcen), pil3_100k.sum .

>>> pos kphiZebra kphiZebraPos
Move completed: kphiZebra : 170.01

------------------------------- Tests with pil3_100k using tiffs and hdf5s only:

>>> kphiZebraPos=kphiZebra() ; print "kphiZebraPos=%r" % (kphiZebraPos)
kphiZebraPos=170.008
>>> pos pil3_100k 1

				Try a 3 point scan

>>> scan   kphi      kphiZebraPos-1 kphiZebraPos+1 1   pil3_100k 0.1
=== Scan started: Tue Jan 21 19:21:31 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
Image location: pilatus3_100k_path_template='808393-pilatus3_100k-files/%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808393.nxs
Writing data to file: /dls/i16/data/2020/mm23911-1/808393.dat
  kphi	       kap	     kth	        kmu	kdelta	  kgam	delta_axis_offset	TimeSec	 TimeFromEpoch	ic1monitor	     rc	count_time	path	maxx	maxy	  maxval	sum
170.01	-134.75609	59.24968	-1.9782e-06	31.376	33.173	           8.8000	135.468	1579634494.774	  0.546457	93.3754	  0.100000	   1	   0	   0	0.000000	-22
171.01	-134.75609	59.24968	2.0585e-06	31.376	33.173	           8.8000	137.006	1579634496.311	  0.494558	93.3675	  0.100000	   2	   0	   0	0.000000	-22
172.01	-134.75609	59.24968	2.0585e-06	31.376	33.173	           8.8000	138.555	1579634497.861	  0.497615	93.3608	  0.100000	   3	   0	   0	0.000000	-22
Creating HDF Links
Scan complete.
=== Scan ended: Tue Jan 21 19:21:38 2020. Elapsed time: 6 seconds
   maxval: At kphi = 170.008 (maxpos), pil3_100k.sum maxval = -22.0. 
   minval: At kphi = 170.008 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphi = 171.008 (com), pil3_100k.sum stddev = 0.666666666667. 
   peak:   Exception: ValueError('There is no peak',)
   lcen:   At kphi = 168.008 (lcen), pil3_100k.sum . 
   rcen:   At kphi = 174.008 (rcen), pil3_100k.sum .

				Try a 201 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .01 pil3_100k 0.1
...
=== Scan started: Tue Jan 21 19:22:30 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
Image location: pilatus3_100k_path_template='808394-kphiZebraPil3-files/00000_%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/mm23911-1/808394.nxs
WARNING: kphi is returning a position based on its real motor position (170.083) rather than its last demanded position(172.008),
as these differ by more than the configured demand position tolerance (0.001).
Writing data to file: /dls/i16/data/2020/mm23911-1/808394.dat
kphiZebra	count_time	path	maxx	maxy	  maxval	sum
   170.01	  0.100000	   0	   0	   0	0.000000	-22
...
   172.01	  0.100000	 200	   0	   0	0.000000	-22
Creating HDF Links
  File "/dls_sw/i16/software/gda_versions/gda_9.15a/workspace_git/gda-mt.git/configurations/i16-config/scripts/nexusHDFLink.py", line 9, in detectorLinkInserter
    entry['data'] = h5py.ExternalLink(detectorFileName, detectorPath)

  File "/dls_sw/apps/python/anaconda/1.7.0/64/lib/python2.7/site-packages/h5py/_hl/group.py", line 392, in __setitem__
    lcpl=lcpl, lapl=self._lapl)

  File "h5py/_objects.pyx", line 54, in h5py._objects.with_phil.wrapper

  File "h5py/_objects.pyx", line 55, in h5py._objects.with_phil.wrapper

  File "h5py/h5l.pyx", line 157, in h5py.h5l.LinkProxy.create_external

Traceback (most recent call last):
  File "<input>", line 1, in <module>
  File "/dls_sw/i16/software/gda_versions/gda_9.15a/workspace_git/gda-core.git/uk.ac.gda.core/scripts/gdascripts/scan/concurrentScanWrapper.py", line 161, in __call__
    scan.runScan()
  File "/dls_sw/i16/software/gda_versions/gda_9.15a/workspace_git/gda-core.git/uk.ac.gda.core/scripts/gdascripts/scan/concurrentScanWrapper.py", line 161, in __call__
    scan.runScan()
  File "/dls_sw/i16/software/gda_versions/gda_9.15a/workspace_git/gda-mt.git/configurations/i16-config/scripts/epics/detector/NxProcessingDetectorWrapper.py", line 69, in atScanEnd
    self.linkFunction(nexusFileName, detectorFileName, nexusPaths, detectorPath)
  File "/dls_sw/i16/software/gda_versions/gda_9.15a/workspace_git/scisoft-core.git/uk.ac.diamond.scisoft.python/src/scisoftpy/external.py", line 529, in __call__
    raise err[1]
RuntimeError: Unable to create link (name already exists)

				Try a 2001 point cvscan

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .001 pil3_100k 0.01

				Try a 4001 point cvscan (0.002 exposure time, 0.005 Acq Period)

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0005 pil3_100k 0.005

				Try a 5001 point cvscan (0.001 exposure time, 0.004 Acq Period)

>>> cvscan kphiZebra kphiZebraPos-1 kphiZebraPos+1 .0004 pil3_100k 0.004

------------------------------------------------------------------- After test:

pos pil3_100k 1
pos kphiZebra kphiZebraPos
pos kthZebra kthZebraPos

================================================================================
2020-01-14 (live) Testing hdf5 file writing

--------------------------------- Baseline test with tif only

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.000000 path: 82397 maxx: 212 maxy: 56 maxval: 2.000000 sum: -12
>>> kphiZebraPos=kphiZebra()
>>> scan kphi kphiZebraPos-1 kphiZebraPos+1 1 pil3_100k 0.1
=== Scan started: Tue Jan 14 17:36:59 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
Image location: pilatus3_100k_path_template='806998-pilatus3_100k-files/%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/806998.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/806998.dat
  kphi	       kap	     kth	       kmu	    kdelta	      kgam	delta_axis_offset	TimeSec	 TimeFromEpoch	ic1monitor	      rc	count_time	path	maxx	maxy	  maxval	sum
56.045	-134.75703	57.04516	6.0952e-06	0.00084979	5.0770e-07	                0	471.595	1579023421.646	  5.006661	298.7057	  0.100000	   1	   0	   0	0.000000	-22
57.045	-134.75703	57.04516	2.0585e-06	0.00084979	4.5444e-06	                0	472.771	1579023422.822	  4.731888	298.6965	  0.100000	   2	   0	   0	0.000000	-22
58.045	-134.75703	57.04516	2.0585e-06	0.00084979	5.0770e-07	                0	473.957	1579023424.008	  4.823479	298.6847	  0.100000	   3	   0	   0	0.000000	-22
Scan complete.
=== Scan ended: Tue Jan 14 17:37:04 2020. Elapsed time: 5 seconds
   maxval: At kphi = 56.045 (maxpos), pil3_100k.sum maxval = -22.0. 
   minval: At kphi = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphi = 57.045 (com), pil3_100k.sum stddev = 0.666666666667. 
   peak:   Exception: ValueError('There is no peak',)
   lcen:   At kphi = 54.045 (lcen), pil3_100k.sum . 
   rcen:   At kphi = 60.045 (rcen), pil3_100k.sum .

--------------------------------- With tif + hdf5

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.000000 path: 82398 maxx: 0 maxy: 0 maxval: 0.000000 sum: -22
>>> kphiZebraPos=kphiZebra()
>>> scan kphi kphiZebraPos-1 kphiZebraPos+1 1 pil3_100k 0.1
=== Scan started: Tue Jan 14 17:45:13 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
Image location: pilatus3_100k_path_template='806999-pilatus3_100k-files/%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/806999.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/806999.dat
  kphi	       kap	     kth	       kmu	    kdelta	      kgam	delta_axis_offset	TimeSec	 TimeFromEpoch	ic1monitor	      rc	count_time	path	maxx	maxy	  maxval	sum
56.045	-134.75703	57.04516	6.0952e-06	0.00084979	5.0770e-07	                0	189.789	1579023916.549	  5.006661	299.5953	  0.100000	   1	   0	   0	0.000000	-22
57.045	-134.75703	57.04516	6.0952e-06	0.00084979	-3.5290e-06	                0	191.314	1579023918.074	  5.128766	299.5869	  0.100000	   2	   0	   0	0.000000	-22
58.045	-134.75703	57.04516	2.0585e-06	0.00084979	5.0770e-07	                0	192.838	1579023919.597	  5.159281	299.5755	  0.100000	   3	   0	   0	0.000000	-22
Warning: gda.scan.endscan.neworder must be True to create hdf links
Scan complete.
=== Scan ended: Tue Jan 14 17:45:19 2020. Elapsed time: 6 seconds
   maxval: At kphi = 56.045 (maxpos), pil3_100k.sum maxval = -22.0. 
   minval: At kphi = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphi = 57.045 (com), pil3_100k.sum stddev = 0.666666666667. 
   peak:   Exception: ValueError('There is no peak',)
   lcen:   At kphi = 54.045 (lcen), pil3_100k.sum . 
   rcen:   At kphi = 60.045 (rcen), pil3_100k.sum . 

>>> pos kphi kphiZebraPos
Move completed: kphi : 57.045

--------------------------------- With tif + hdf5 - after defaulting gda.scan.endscan.neworder to True in NxProcessingDetectorWrapper

>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.000000 path: 82400 maxx: 216 maxy: 14 maxval: 2.000000 sum: -5
>>> kphiZebraPos=kphiZebra()
>>> scan kphi kphiZebraPos-1 kphiZebraPos+1 1 pil3_100k 0.1
=== Scan started: Tue Jan 14 18:08:41 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
Image location: pilatus3_100k_path_template='807001-pilatus3_100k-files/%05d.tif
Writing data to file (NeXus): /dls/i16/data/2020/cm26473-1/807001.nxs
Writing data to file: /dls/i16/data/2020/cm26473-1/807001.dat
  kphi	       kap	     kth	       kmu	    kdelta	      kgam	delta_axis_offset	TimeSec	 TimeFromEpoch	ic1monitor	      rc	count_time	path	maxx	maxy	  maxval	sum
56.045	-134.75718	57.04516	6.0952e-06	0.00084979	4.5444e-06	                0	104.863	1579025324.080	  5.006661	298.5471	  0.100000	   1	   0	   0	0.000000	-22
57.045	-134.75717	57.04516	2.0585e-06	0.00084979	4.5444e-06	                0	106.393	1579025325.611	  5.342463	298.5370	  0.100000	   2	   0	   0	0.000000	-22
58.045	-134.75717	57.04516	2.0585e-06	0.00084979	8.5811e-06	                0	107.752	1579025326.969	  5.220357	298.5288	  0.100000	   3	   0	   0	0.000000	-22
Creating HDF Links
Scan complete.
=== Scan ended: Tue Jan 14 18:08:47 2020. Elapsed time: 6 seconds
   maxval: At kphi = 56.045 (maxpos), pil3_100k.sum maxval = -22.0. 
   minval: At kphi = 56.045 (minpos), pil3_100k.sum minval = -22.0. 
   com:    At kphi = 57.045 (com), pil3_100k.sum stddev = 0.666666666667. 
   peak:   Exception: ValueError('There is no peak',)
   lcen:   At kphi = 54.045 (lcen), pil3_100k.sum . 
   rcen:   At kphi = 60.045 (rcen), pil3_100k.sum . 

>>> pos kphi kphiZebraPos
Move completed: kphi : 57.045

--------------------------------- With hdf5 only

>>> scan kphi kphiZebraPos-1 kphiZebraPos+1 1 pil3_100k 0.1
=== Scan started: Tue Jan 14 17:52:31 2020
Getting meta data before scan
Collecting metadata from: kgam kdelta delta_offset kap kphi kth kmu dummypd mrwolf diffractometer_sample source jjslits pa PPR positions gains_atten mirrors beamline_slits mono lakeshore offsets s7xgap s7xtrans s7ygap s7ytrans ppy ppx ppchi ppth1 ppz1 ppth2 ppz2 ppyaw pppitch ppchitemp ppth1temp ppz1temp ppth2temp ppz2temp p2 dettrans en psi alpha beta xtlinfo
Metadata collection complete
===Injection mode pausing is enabled: TimeToInjection must exceed 5
====================================================================================================
Exception: during scan collection: DeviceException: Array index out of range: 1
Error occurred when closing data file(s): 
Traceback (most recent call last):
  File "<input>", line 1, in <module>
  File "/dls_sw/i16/software/gda_versions/gda_9.15b/workspace_git/gda-core.git/uk.ac.gda.core/scripts/gdascripts/scan/concurrentScanWrapper.py", line 161, in __call__
    scan.runScan()
  File "/dls_sw/i16/software/gda_versions/gda_9.15b/workspace_git/gda-core.git/uk.ac.gda.core/scripts/gdascripts/scan/concurrentScanWrapper.py", line 161, in __call__
    scan.runScan()

java.lang.Exception: during scan collection: DeviceException: Array index out of range: 1
>>> pos pil3_100k 1
Move completed: pil3_100k : count_time: 0.100000 path: 82399 maxx: 90 maxy: 169 maxval: 2.000000 sum: -18

--------------------------------- Comparing nexus files

module load dasctools
module load kdiff3

nexus.tree /dls/i16/data/2020/cm26473-1/806998.nxs > 806998.nxs.tree	# tif
nexus.tree /dls/i16/data/2020/cm26473-1/806999.nxs > 806999.nxs.tree	# tif+hdf5 gda.scan.endscan.neworder assumed false
nexus.tree /dls/i16/data/2020/cm26473-1/807001.nxs > 807001.nxs.tree	# tif+hdf5 gda.scan.endscan.neworder assumed true
kdiff3 *.nxs.tree

 	root:NXroot
 	  entry1:NXentry
 	    instrument:NXinstrument
=	      pil3_100k:NXdetector
 	        ...
+	        data -> 807001-pilatus3_100k-files/807001.hdf['/entry/instrument/detector/data']
=	    pil3_100k:NXdetector
 	      ...
+	      data -> 807001-pilatus3_100k-files/807001.hdf['/entry/instrument/detector/data']

--------------------------------- Tests

pos pil3_100k 1 # At start to check pil3 is running Ok

kphiZebraPos=kphiZebra()
scan kphi kphiZebraPos-1 kphiZebraPos+1 1 pil3_100k 0.1
pos kphi kphiZebraPos

pos pil3_100k 1 # After any scan failures to make sure it's still running

================================================================================
I16-211

Opening the Scanning Perspective before opening the Mapping Perspective causes the Mapped Data view on the Scanning perspective to fail to initialise.
Opening the Mapping Perspective before opening the Scanning Perspective doesn't.

>>> from mapping_scan_commands import mscan, grid, detector
>>> mscan(path=[grid(axes=('stage_x', 'stage_y'), start=(-1.5, -1.0), stop=(0.5, 1.0), count=(25, 25), snake=False, continuous=False)], det=[detector('mandelbrot', 0.1, maxIterations=500, escapeRadius=10.0, columns=301, rows=241, points=1000, maxRealCoordinate=1.5, maxImaginaryCoordinate=1.2, realAxisName='stage_x', imaginaryAxisName='stage_y', enableNoise=False, noiseFreeExposureTime=5.0, saveImage=True, saveSpectrum=True, saveValue=True)])
>>> mscan(monitorsPerScan=[mrwolf], path=[grid(axes=('stage_x', 'stage_y'), start=(-1.5, -1.0), stop=(0.5, 1.0), count=(25, 25), snake=False, continuous=False)], det=[detector('mandelbrot', 0.1, maxIterations=500, escapeRadius=10.0, columns=301, rows=241, points=1000, maxRealCoordinate=1.5, maxImaginaryCoordinate=1.2, realAxisName='stage_x', imaginaryAxisName='stage_y', enableNoise=False, noiseFreeExposureTime=5.0, saveImage=True, saveSpectrum=True, saveValue=True)])
>>> meta_add mrwolf
>>> mscan(path=[grid(axes=('stage_x', 'stage_y'), start=(-1.5, -1.0), stop=(0.5, 1.0), count=(25, 25), snake=False, continuous=False)], det=[detector('mandelbrot', 0.1, maxIterations=500, escapeRadius=10.0, columns=301, rows=241, points=1000, maxRealCoordinate=1.5, maxImaginaryCoordinate=1.2, realAxisName='stage_x', imaginaryAxisName='stage_y', enableNoise=False, noiseFreeExposureTime=5.0, saveImage=True, saveSpectrum=True, saveValue=True)])

New scanning syntax

mscan(grid(axes=(stage_x, stage_y), step=(1,1), start=(0,0), stop=(10,4), snake=false, det=detector('mic', 0.1)))
= mscan stage_x stage_y 0 0 10 4 1 1 mic 0.1

from gdascripts.mscanHandler import *

mscan(path=[grid(axes=('stage_x', 'stage_y'), start=(-1.5, -1.0), stop=(0.5, 1.0), count=(25, 25), snake=False, continuous=False)], det=[detector('mandelbrot', 0.1, maxIterations=500, escapeRadius=10.0, columns=301, rows=241, points=1000, maxRealCoordinate=1.5, maxImaginaryCoordinate=1.2, realAxisName='stage_x', imaginaryAxisName='stage_y', enableNoise=False, noiseFreeExposureTime=5.0, saveImage=True, saveSpectrum=True, saveValue=True)])
X= mscan stage_x stage_y -1.5, -1 .5,1 .08,.08 mandelbrot 0.1
X= mscan stage_x stage_y -1.5, -1 .5,1 .08,.08 dummyMandelbrotMappingDetector2D 0.1

Creating a 'mandelbrot' detector with the same definition as 'dummyMandelbrotMappingDetector2D' allowed 'mscan stage_x stage_y -1.5, -1 .5,1 .08,.08 mandelbrot 0.1' to work
Doing the same with 'dummyMandelbrotMappingDetector1D'
================================================================================