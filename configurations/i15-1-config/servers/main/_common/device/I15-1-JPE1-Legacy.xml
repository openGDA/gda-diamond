<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

	<!-- NXDetector collection strategies -->

	<!-- Create collection strategy by composition -->
	<bean id="pe_AutoSummingProcessImageModeCollectionStrategy" 
			class="gda.device.detector.addetector.collectionstrategy.AutoSummingProcessDecorator">
		<property name="ndProcess" ref="peAD_summary_proc2" />
		<property name="processDataTypeOut" value="4" />
		<property name="decoratee">
			<bean class="gda.device.detector.addetector.collectionstrategy.MultipleImageModeDecorator">
				<property name="decoratee">
					<bean class="gda.device.detector.addetector.collectionstrategy.InternalTriggerModeDecorator">
						<property name="restoreTriggerMode" value="true"/>
						<property name="decoratee">
							<bean class="gda.device.detector.addetector.collectionstrategy.SoftwareStartStop">
								<property name="adBase" ref="peAD_config_base" />
							</bean>
						</property>
					</bean>
				</property>
			</bean>
		</property>
	</bean>
	<!-- A value of 4 in processDataTypeOut set the proc output to Int32, it defaults to 5 which is UInt32.
		 Although having the wrong value for this doesn't cause problems for the tiff writer, it does cause
		 twos complement signed data to be written to the HDF5 annotated as UInt32, i.e. small -ve values
		 are seen as huge positive values. -->

	<!-- Create collection strategy by composition -->
	<bean id="pe_ContinuousCollectionStrategy" class="gda.device.detector.addetector.collectionstrategy.AutoSummingProcessDecorator">
		<property name="ndProcess" ref="peAD_summary_proc2" />
		<property name="processDataTypeOut" value="4" />
		<property name="decoratee">
			<bean class="gda.device.detector.addetector.collectionstrategy.InternalTriggerModeDecorator">
				<property name="restoreTriggerMode" value="true"/>
				<property name="decoratee">
					<bean class="gda.device.detector.addetector.collectionstrategy.ContinuousAcquisition">
						<property name="adBase" ref="peAD_config_base" />
						<property name="ndFile" ref="pe_NDFileTiff"/>
					</bean>
				</property>
			</bean>
		</property>
	</bean>
	<!-- A value of 4 in processDataTypeOut set the proc output to Int32, it defaults to 5 which is UInt32.
		 Although having the wrong value for this doesn't cause problems for the tiff writer, it does cause
		 twos complement signed data to be written to the HDF5 annotated as UInt32, i.e. small -ve values
		 are seen as huge positive values. -->

	<!-- SingleImagePerFileWriter(String detectorName)
	 -->
	<bean id="pe_tiff_SingleImagePerFileWriter" class="gda.device.detector.addetector.filewriter.SingleImagePerFileWriter">
		<constructor-arg value="pe" />
		<property name="ndFile" ref="pe_NDFileTiff" />
		<property name="fileTemplate" value="%s%s%05d.tif" />
		<property name="filePathTemplate" value="$datadir$/$scan$/pe" />
		<property name="fileNameTemplate" value="" />
		<property name="fileNumberAtScanStart" value="1" />
		<property name="keyNameForMetadataPathTemplate" value="pe_path_template" />
		<!-- TODO: While we can set ndArrayPortVal from here, this filewriter may be used by detectors with different collection
			 strategies so we should have the option to take the filewriter port from the collection Strategy. For example: -->
		<!-- When using pe_SingleExposureStandardCollectionStrategy it needs to be set to pe1.cam, but 
			 When using pe_MultipleExposureSoftwareTriggerAutoModeCollectionStrategy without dark subtraction this needs to be set
			 we need to use pe1.proc.proc2 and with dark subtraction it needs to be set we need to use pe1.proc.proc3
		 -->
		<property name="ndArrayPortVal" value="pe1.proc.proc3" />
	</bean>

	<!-- NXDetectors -->

	<bean id="pe" class="gda.device.detector.HardwareTriggeredNXDetectorWithReadoutTime">
		<property name="name" value="pe"/>
		<!-- 
		<property name="hardwareTriggerProvider" ref="zebraContinuousMoveController"/>
		 -->
		<property name="collectionStrategy" ref="pe_ContinuousCollectionStrategy" />
		<property name="additionalPluginList">
			<list>
				<ref bean="pe_hdf5_MultipleImagesPerHDF5FileWriter" />
				<ref bean="pe_tiff_SingleImagePerFileWriter" />
			</list>
		</property>
	</bean>

	<bean id="peLegacy" class="gda.device.detector.HardwareTriggeredNXDetectorWithReadoutTime">
		<property name="name" value="peLegacy"/>
		<!-- 
		<property name="hardwareTriggerProvider" ref="zebraContinuousMoveController"/>
		 -->
		<property name="collectionStrategy" ref="pe_AutoSummingProcessImageModeCollectionStrategy" />
		<property name="additionalPluginList">
			<list>
				<ref bean="pe_hdf5_MultipleImagesPerHDF5FileWriter" />
				<ref bean="pe_tiff_SingleImagePerFileWriter" />
			</list>
		</property>
	</bean>

	<!-- ADDetectors -->

	<bean id="peAD" class="gda.device.detector.addetector.ADDetector">
		<property name="adBase" ref="peAD_config_base"/>
		<property name="collectionStrategy" ref="pe_ContinuousCollectionStrategy" />
		<property name="ndFile"  ref="pe_NDFileHDF5file"/>
		<property name="ndArray" ref="peAD_summary_arr"/>
		<property name="ndStats" ref="peAD_summary_stat"/>
		<property name="fileWriter" ref="pe_hdf5_MultipleImagesPerHDF5FileWriter"/>
	</bean>

	<bean id="peLegacyAD" class="gda.device.detector.addetector.ADDetector">
		<property name="adBase" ref="peAD_config_base"/>
		<property name="collectionStrategy" ref="pe_AutoSummingProcessImageModeCollectionStrategy" />
		<property name="ndFile"  ref="pe_NDFileHDF5file"/>
		<property name="ndArray" ref="peAD_summary_arr"/>
		<property name="ndStats" ref="peAD_summary_stat"/>
		<property name="fileWriter" ref="pe_hdf5_MultipleImagesPerHDF5FileWriter"/>
	</bean>

	<!-- Scanning API -->

	<bean id="peADnexusModel" class="uk.ac.diamond.daq.detectors.addetector.api.AreaDetectorRunnableDeviceModel">
		<property name="name"                   value="peAD"/>
		<property name="exposureTime"           value="0.1"/>
	</bean>
	<bean id="peADnexusInfo" class="org.eclipse.scanning.api.event.scan.DeviceInformation">
		<property name="name"        value="peAD"/>
		<property name="id"          value="org.eclipse.scanning.api.event.scan.DeviceInformation.peADnexusInfo"/>
		<property name="label"       value="Perkin Elmer 1 Continuous Nexus (peADnexusInfo)"/>
		<property name="description" value="Perkin Elmer 1 with continuous running and images written to Nexus file by the scan"/>
		<property name="icon"        value="org.eclipse.scanning.example/icons/alarm-clock-select.png"/> 
	</bean>
	<bean id="peADnexusDetector" class="uk.ac.diamond.daq.detectors.addetector.AreaDetectorRunnableDevice" init-method="register">
		<property name="name"              value="peAD"/>
		<property name="model"             ref="peADnexusModel"/>
		<property name="deviceInformation" ref="peADnexusInfo"/>
		<property name="activated"         value="false"/>
	</bean>

	<!-- vvv is based on ^^^ but with the Area Detector writing hdf5 files rather than the images being written to the
							 scan Nexus file. Only the second will show in the Scanning perspective. -->

	<bean id="peADhdf5Model" class="uk.ac.diamond.daq.detectors.addetector.api.AreaDetectorWritingFilesRunnableDeviceModel">
		<property name="name"                   value="peAD"/>
		<property name="exposureTime"           value="0.1"/>
	</bean>
	<bean id="peADhdf5Info" class="org.eclipse.scanning.api.event.scan.DeviceInformation">
		<property name="name"        value="peAD"/>
		<property name="id"          value="org.eclipse.scanning.api.event.scan.DeviceInformation.peADhdf5Info"/>
		<property name="label"       value="Perkin Elmer 1 Continuous HDF5 (peADhdf5Info)"/>
		<property name="description" value="Perkin Elmer 1 with continuous running and images written to HDF5 file by Area Detector"/>
		<property name="icon"        value="org.eclipse.scanning.example/icons/alarm-clock-select.png"/> 
	</bean>
	<bean id="peADhdf5Detector" class="uk.ac.diamond.daq.detectors.addetector.AreaDetectorWritingFilesRunnableDevice" init-method="register">
		<property name="name"              value="peAD"/>
		<property name="model"             ref="peADhdf5Model"/>
		<property name="deviceInformation" ref="peADhdf5Info"/>
		<property name="activated"         value="false"/>
	</bean>

	<!-- Legacy mode -->

	<bean id="peLegacyADhdf5Model" class="uk.ac.diamond.daq.detectors.addetector.api.AreaDetectorWritingFilesRunnableDeviceModel">
		<property name="name"                   value="peLegacyAD"/>
		<property name="exposureTime"           value="0.1"/>
	</bean>
	<bean id="peLegacyADhdf5Info" class="org.eclipse.scanning.api.event.scan.DeviceInformation">
		<property name="name"        value="peLegacyAD"/>
		<property name="id"          value="org.eclipse.scanning.api.event.scan.DeviceInformation.peLegacyADhdf5Info"/>
		<property name="label"       value="Perkin Elmer 1 StopStart HDF5 (peLegacyADhdf5Info)"/>
		<property name="description" value="Perkin Elmer 1 with non-continuous running and images written to HDF5 file by Area Detector"/>
		<property name="icon"        value="org.eclipse.scanning.example/icons/alarm-clock-select.png"/> 
	</bean>
	<bean id="peLegacyADhdf5Detector" class="uk.ac.diamond.daq.detectors.addetector.AreaDetectorWritingFilesRunnableDevice" init-method="register">
		<property name="name"              value="peLegacyAD"/>
		<property name="model"             ref="peLegacyADhdf5Model"/>
		<property name="deviceInformation" ref="peLegacyADhdf5Info"/>
		<property name="activated"         value="false"/>
	</bean>

	<!-- vvv is based on ^^^ but with the Area Detector writing hdf5 files rather than the images being written to the
							 scan Nexus file. Only the second will show in the Scanning perspective. -->

	<bean id="peLegacyADnexusModel" class="uk.ac.diamond.daq.detectors.addetector.api.AreaDetectorWritingFilesRunnableDeviceModel">
		<property name="name"                   value="peLegacyAD"/>
		<property name="exposureTime"           value="0.1"/>
	</bean>
	<bean id="peLegacyADnexusInfo" class="org.eclipse.scanning.api.event.scan.DeviceInformation">
		<property name="name"        value="peLegacyAD"/>
		<property name="id"          value="org.eclipse.scanning.api.event.scan.DeviceInformation.peLegacyADnexusInfo"/>
		<property name="label"       value="Perkin Elmer 1 StopStart Nexus (peLegacyADnexusInfo)"/>
		<property name="description" value="Perkin Elmer 1 with non-continuous running and images written to Nexus file by the scan"/>
		<property name="icon"        value="org.eclipse.scanning.example/icons/alarm-clock-select.png"/> 
	</bean>
	<bean id="peLegacyADnexusDetector" class="uk.ac.diamond.daq.detectors.addetector.AreaDetectorRunnableDevice" init-method="register">
		<property name="name"              value="peLegacyAD"/>
		<property name="model"             ref="peLegacyADnexusModel"/>
		<property name="deviceInformation" ref="peLegacyADnexusInfo"/>
		<property name="activated"         value="false"/>
	</bean>
</beans>
