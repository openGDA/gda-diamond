#!/bin/bash

. $(dirname "$0")/GDA_common gda_client_output

export GDA_CLIENT_LOG_DIR=$GDA_LOGS_DIR

VMARGS="-Xms512m -Xmx1024m -XX:PermSize=128m -XX:MaxPermSize=1024m $VMARGS"
VMARGS="-Dgda.client.jython.automatic.interpreter=1 $VMARGS"
VMARGS="-Duk.ac.diamond.scisoft.analysis.analysisrpcserverprovider.disable=True $VMARGS"
VMARGS="-Duk.ac.diamond.scisoft.analysis.rmiserverprovider.disable=True $VMARGS"

VMARGS="-Dgda.config=$GDA_CONFIG $VMARGS"
# This is used to produce per user client log files:
VMARGS="-DUSERNAME=$(whoami) $VMARGS"

# These should really be defined according to which mode we are in:
VMARGS="-Declipse.pluginCustomization=$GDA_CONFIG/clients/main/common/pluginCustomization.ini $VMARGS"
VMARGS="-Dgda.propertiesFile=$GDA_CONFIG/properties/dummy/java.properties $VMARGS"
VMARGS="-Djacorb.config.dir=$GDA_CONFIG/jacorb/dummy $VMARGS"
VMARGS="-Dgov.aps.jca.JCALibrary.properties=$GDA_CONFIG/jca/dummy/JCALibrary.properties $VMARGS"
VMARGS="-Dgda.mode=dummy $VMARGS"

# Even though gda.logs.dir is defined in java.properties this appears to be too late for the client logger so
# a gda.logs.dir_IS_UNDEFINED directory is created without the following line:
VMARGS="-Dgda.logs.dir=$GDA_LOGS_DIR $VMARGS"

export GDA_CLIENT_VMARGS=$VMARGS
#echo  GDA_CLIENT_VMARGS=$VMARGS
export GDA_CLIENT=$GDA_ROOT/client/gda-$BEAMLINE

$GDA_CLIENT_SCRIPT --log --keep --nohup $GDA_CONSOLE_LOG $*
