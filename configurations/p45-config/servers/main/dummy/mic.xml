<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gda="http://www.diamond.ac.uk/schema/gda/gda"
	xmlns:corba="http://www.diamond.ac.uk/schema/gda/corba"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	http://www.diamond.ac.uk/schema/gda/gda http://www.diamond.ac.uk/schema/gda/gda/gda-gda-1.0.xsd
	http://www.diamond.ac.uk/schema/gda/corba http://www.diamond.ac.uk/schema/gda/corba/gda-corba-1.0.xsd">

	<description>
		To use the Simulated Area detector in dummy mode:
			1) Launch the Utilities > GDA SWMR AreaDetector Simulation
				and start the IOC.
			2) export the WORKSTATION environment variable with the short name for
				the machine the Simulation IOC is running on (e.g. ws123).
			3) Uncomment the include for this file in ./server.xml and launch
				the GDA servers.
	</description>

	<bean id="adsim_adbase" class="gda.device.detector.areadetector.v17.impl.ADBaseImpl">
		<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:CAM:" />
	</bean>

	<bean id="adsim_stats" class="gda.device.detector.areadetector.v17.impl.NDStatsImpl">
		<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:STAT:" />
		<property name="pluginBase">
			<bean class="gda.device.detector.areadetector.v17.impl.NDPluginBaseImpl">
				<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:STAT:" />
				<property name="initialArrayPort" value="CAM.CAM" />
			</bean>
		</property>
	</bean>

	<bean id="adsim_ndarray" class="gda.device.detector.areadetector.v17.impl.NDArrayImpl">
		<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:ARR:" />
		<property name="pluginBase">
			<bean class="gda.device.detector.areadetector.v17.impl.NDPluginBaseImpl">
				<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:ARR:" />
				<property name="initialArrayPort" value="CAM.CAM" />
			</bean>
		</property>
	</bean>

	<bean id="adsim_ndfile" class="gda.device.detector.areadetector.v17.impl.NDFileImpl">
		<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:HDF5:" />
		<property name="pluginBase">
			<bean class="gda.device.detector.areadetector.v17.impl.NDPluginBaseImpl">
				<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:HDF5:" />
				<property name="initialArrayPort" value="CAM.stat" />
			</bean>
		</property>
		<!-- These arguments are here to please Spring -->
		<property name="initialAutoSave" value="Not hooked up to anything!" />
		<property name="initialAutoIncrement" value="Not hooked up to anything!" />
		<property name="initialWriteMode" value="0" />
		<property name="initialNumCapture" value="1" />
		<property name="initialFileName" value="adsim" />
		<property name="initialFileTemplate" value="%s%s.hdf5" />
	</bean>

	<bean id="adsim_hdf5"
		class="gda.device.detector.areadetector.v17.impl.NDFileHDF5Impl">
		<property name="basePVName" value="${WORKSTATION}-AD-SIM-01:HDF5:" />
		<property name="file" ref="adsim_ndfile" />
	</bean>

	<!-- This seems a bit redundant in the new scanning but keeping it for now 
		to fit with the current ADDectector framework -->
	<bean id="adsim_hdf5_writer"
		class="gda.device.detector.addetector.filewriter.MultipleImagesPerHDF5FileWriter">
		<property name="ndFileHDF5" ref="adsim_hdf5" />
		<property name="fileTemplate" value="%s%s.hdf5" />
		<property name="filePathTemplate" value="$datadir$" />
		<property name="fileNameTemplate" value="" />
		<property name="fileNumberAtScanStart" value="-1" />
		<property name="setFileNameAndNumber" value="true" />
	</bean>

	<bean id="mic" class="gda.device.detector.addetector.ADDetector">
		<property name="adBase" ref="adsim_adbase" />
		<property name="ndFile" ref="adsim_ndfile" />
		<property name="ndArray" ref="adsim_ndarray" />
		<property name="ndStats" ref="adsim_stats" />
		<property name="fileWriter" ref="adsim_hdf5_writer" />
	</bean>

	<!--  Area Detector Example -->
	<bean id="areaDetectorModel" class="uk.ac.diamond.daq.detectors.addetector.api.AreaDetectorRunnableDeviceModel">
		<property name="name"                   value="mic"/>
		<property name="exposureTime"           value="0.1"/>
	</bean>
	<bean id="areaDetectorInfo" class="org.eclipse.scanning.api.event.scan.DeviceInformation">
		<property name="id"          value="org.eclipse.scanning.example.malcolm.dummyMalcolmDetectorSpring"/>
		<property name="label"       value="Area Detector Simulation"/>
		<property name="description" value="A simulation area detector IOC"/>
<!-- 		<property name="icon"        value="org.eclipse.scanning.example/icons/alarm-clock-select.png"/>  bundle must be on client for that, if it isn't a default icon is used -->
	</bean>
	<bean id="areaDetector" class="uk.ac.diamond.daq.detectors.addetector.AreaDetectorRunnableDevice" init-method="register">
		<property name="name"              value="Area Detector Simulation"/>
		<property name="model"             ref="areaDetectorModel"/>
		<property name="deviceInformation" ref="areaDetectorInfo"/>
		<property name="activated"         value="true"/> <!-- This means it is activated as the default device to use in a scan -->
	</bean>

</beans>
